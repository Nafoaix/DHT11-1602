C51 COMPILER V9.00   DHT11                                                                 09/14/2020 14:07:40 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE DHT11
OBJECT MODULE PLACED IN .\Objects\DHT11.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil\C51\BIN\C51.EXE DHT11.c OPTIMIZE(1,SPEED) BROWSE DEBUG OBJECTEXTEND PRI
                    -NT(.\Listings\DHT11.lst) OBJECT(.\Objects\DHT11.obj)

line level    source

*** WARNING C500 IN LINE 1 OF DHT11.C: LICENSE ERROR (R208: RENEW LICENSE ID CODE (LIC))

   1          #include "DHT11.h"
   2          
   3          unsigned char rec_dat[16];
   4          unsigned char RH,TH;
   5          unsigned int timeout;
   6          
   7          void DHT11_delay_ms(unsigned int ms)
   8          {
   9   1         unsigned int i,j; 
  10   1         for(i=ms;i>0;i--)
  11   1            for(j=113;j>0;j--);
  12   1      }
  13          
  14          void DHT11_start()
  15          {
  16   1              start_led3 = 0;
  17   1          DHT11_Data = 1;                     // ä¸»æœºæŠŠæ€»çº¿æ‹‰é«˜å‡†å¤‡å‘é€å¼€å§‹ä¿¡å·
  18   1              DHT11_Data = 0;            
  19   1              DHT11_delay_ms(20);             // ä¸»æœºæŠŠæ€»çº¿æ‹‰ä½å¿…é¡»å¤§äº18msî€‚ä¿è¯DHT11èƒ½æ£€æµ‹åˆ°èµ·å§‹ä¿¡å· 
  20   1              DHT11_Data=1;                   //å‘é€å¼€å§‹ä¿¡å·ç»“æŸåî€‚æ‹‰é«˜ç”µå¹³å»¶æ—¶20-40us ç­‰å¾…DHTçš„å“åº”ä¿¡å·
  21   1              start_led3 = 1;
  22   1      }
  23          
  24          unsigned char ask()
  25          {
  26   1          
  27   1          timeout=0;
  28   1              while(DHT11_Data)
  29   1              {
  30   2                      if(++timeout>300)
  31   2                              return 0;
  32   2              }
  33   1              ASK_LED6 = 0;
  34   1              if(DHT11_Data == 0)     //DHT11æ˜¯å¦ä½ç”µå¹³å“åº”
  35   1              {
  36   2                      timeout=0;
  37   2                      while(!DHT11_Data) //ä½ç”µå¹³ç»“æŸ
  38   2                      {
  39   3                              if(++timeout>167)
  40   3                                      return 0;
  41   3                      }
  42   2                      timeout=0;
  43   2                      while(DHT11_Data)    //æ‹‰é«˜å»¶æ—¶å‡†å¤‡è¾“å‡º
  44   2                      {
  45   3                              if(++timeout>50)
  46   3                                      return 0;
  47   3                      }
  48   2              }
  49   1              else
  50   1              {
  51   2                      return 0;
  52   2              }
  53   1          ASK_LED6 = 1;
C51 COMPILER V9.00   DHT11                                                                 09/14/2020 14:07:40 PAGE 2   

  54   1              return 1;
  55   1      }
  56              
  57          unsigned char DHT11_rec_byte()      //æ¥æ”¶ä¸€ä¸ªå­—èŠ‚
  58          {
  59   1              unsigned char i,retry,dat=0;
  60   1              rec_byte_led7 = 0;
  61   1              for(i=0;i<8;i++)    //ä»é«˜åˆ°ä½ä¾æ¬¡æ¥æ”¶8ä½æ•°æ®
  62   1              {          
  63   2                      while(!DHT11_Data);   //ç­‰å¾…50usä½ç”µå¹³è¿‡å»
  64   2                      {retry++;if(retry>100)return -1;}
  65   2                      retry = 0;
  66   2                      _nop_();
  67   2                      _nop_();
  68   2                      _nop_();
  69   2                      _nop_();
  70   2                      _nop_();
  71   2                      _nop_();
  72   2                      _nop_();
  73   2                      _nop_();
  74   2                      _nop_();
  75   2                      _nop_();
  76   2                      _nop_();
  77   2                      _nop_();
  78   2                      _nop_();
  79   2                      _nop_();
  80   2                      _nop_();
  81   2                      _nop_();
  82   2                      _nop_();
  83   2                      _nop_();
  84   2                      _nop_();
  85   2                      _nop_();
  86   2                      _nop_();
  87   2                      _nop_();
  88   2                      _nop_();
  89   2                      _nop_();
  90   2                      _nop_();
  91   2                      _nop_(); //26ä¸ªæœºå™¨å‘¨æœŸå»¶æ—¶28.21us
  92   2                      dat <<= 1;           //æ•°æ®ä¸º0æ—¶ç›´æ¥ç§»ä½
  93   2                      if(DHT11_Data == 1)    //æ•°æ®ä¸º1æ—¶ï¼Œä½¿datåŠ 1æ¥æ¥æ”¶æ•°æ®1
  94   2                      dat += 1;
  95   2                      while(DHT11_Data);  //ç­‰å¾…æ•°æ®çº¿æ‹‰ä½  
  96   2                      {retry++;if(retry>100)return -1;}
  97   2                      retry = 0;
  98   2              } 
  99   1              rec_byte_led7 = 1;
 100   1              return dat;
 101   1      }
 102          
 103          
 104          void  DHT11_rec_40()      //æ¥æ”¶40ä½çš„æ•°æ®
 105          {
 106   1      
 107   1          unsigned char R_H,R_L,T_H,T_L,RL,TL,revise; //Relative Humidity(ç›¸å¯¹æ¹¿åº¦)åœ¨45%ï½65%ä¹‹é—´åˆé€‚ã
             -€‚temperature
 108   1              rec_40_led8 = 0;
 109   1          DHT11_start();
 110   1              
 111   1          if( ask() )   //åˆ¤æ–­æ˜¯å¦æœ‰DHT11å‘é€ä½ç”µå¹³å“åº”ä¿¡å·
 112   1          {   
 113   2                      test_led5 = 0;
 114   2                      NOresponse_led2 = 1;     //DHT11å“åº”LED2å…³é—­          
C51 COMPILER V9.00   DHT11                                                                 09/14/2020 14:07:40 PAGE 3   

 115   2              R_H=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦é«˜å…«ä½
 116   2              R_L=DHT11_rec_byte();    //æ¥æ”¶æ¹¿åº¦ä½å…«ä½  
 117   2              T_H=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦é«˜å…«ä½  
 118   2              T_L=DHT11_rec_byte();    //æ¥æ”¶æ¸©åº¦ä½å…«ä½
 119   2              revise=DHT11_rec_byte(); //æ¥æ”¶æ ¡æ­£ä½å…«ä½
 120   2              
 121   2              
 122   2              while(!DHT11_Data)    //DATA å¼•è„šè¾“å‡º40ä½æ•°æ®åç»§ç»­è¾“å‡ºä½ç”µå¹³ 50 å¾®ç§’åè½¬ä¸ºè¾“
             -å…¥çŠ¶æ€ï¼Œç”±äºä¸Šæ‹‰ç”µé˜»éšä¹‹å˜ä¸ºé«˜ç”µå¹³ã€‚DHT11 å†…éƒ¨é‡æµ‹ç¯å¢ƒæ¸©æ¹¿åº¦æ•°æ®ï¼Œå¹¶è®°å½•æ•°æ®ï¼Œç­‰å¾…
             -å¤–éƒ¨ä¿¡å·çš„åˆ°æ¥ã€‚
 123   2      
 124   2              if((R_H+R_L+T_H+T_L) == revise)      //æ ¡æ­£
 125   2              {
 126   3                  RH = R_H;
 127   3                  RL = R_L;
 128   3                  TH = T_H;
 129   3                  TL = T_L;
 130   3                  ERRORREVISE_LED4 = 1; //æ ¡éªŒæˆåŠŸLED4ç†„ç­
 131   3              }else{
 132   3                  ERRORREVISE_LED4 = 0; //æ ¡éªŒå¤±è´¥LED4ç‚¹äº®
 133   3              }               
 134   2                  /*æ•°æ®å¤„ç†ï¼Œæ–¹ä¾¿æ˜¾ç¤º*/
 135   2                                      rec_dat[0] = 'R';
 136   2                                      rec_dat[1] = 'H';
 137   2                                      rec_dat[2] = ':';
 138   2                                      rec_dat[3] = '0'+(RH/10);
 139   2                                      rec_dat[4] = '0'+(RH%10);
 140   2                                      rec_dat[5] = '%';
 141   2                                      rec_dat[6] = ' ';
 142   2                                      rec_dat[7] = ' ';
 143   2                                      rec_dat[8] = ' ';
 144   2                                      rec_dat[9] = ' ';
 145   2                                      rec_dat[10] = 'T';
 146   2                                      rec_dat[11] = ':';
 147   2                                      rec_dat[12] = '0'+(TH/10);
 148   2                                      rec_dat[13] = '0'+(TH%10);
 149   2                                      rec_dat[14] = '0'+175; 
 150   2                                      rec_dat[15] = 'C';
 151   2       
 152   2                                      rec_40_led8 = 1;
 153   2                                      test_led5 = 1;          
 154   2          }else{
 155   2                      NOresponse_led2 = 0; //todo:DHT11æœªå“åº”
 156   2              }       
 157   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    491    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     36    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
